CREATE TABLE t1 (a INT)ENGINE=InnoDB;
INSERT INTO t1 VALUES(1);
SET alter_algorithm='INPLACE';
affected rows: 0
PREPARE stmt FROM 'ALTER TABLE t1 ADD KEY idx(a)';
affected rows: 0
info: Statement prepared
PREPARE stmt1 FROM 'ALTER TABLE t1 DROP KEY idx';
affected rows: 0
info: Statement prepared
CREATE OR REPLACE PROCEDURE p1()
BEGIN
ALTER TABLE t1 ADD KEY idx2(a);
END|
affected rows: 0
CREATE OR REPLACE PROCEDURE p2()
BEGIN
ALTER TABLE t1 DROP KEY idx2;
END|
affected rows: 0
SET alter_algorithm='COPY';
affected rows: 0
EXECUTE stmt;
affected rows: 1
info: Records: 1  Duplicates: 0  Warnings: 0
EXECUTE stmt1;
affected rows: 1
info: Records: 1  Duplicates: 0  Warnings: 0
call p1();
affected rows: 1
call p2();
affected rows: 1
SET alter_algorithm='NOCOPY';
affected rows: 0
EXECUTE stmt;
affected rows: 0
info: Records: 0  Duplicates: 0  Warnings: 0
EXECUTE stmt1;
affected rows: 0
info: Records: 0  Duplicates: 0  Warnings: 0
call p1();
affected rows: 0
call p2();
affected rows: 0
SET alter_algorithm='INSTANT';
affected rows: 0
EXECUTE stmt;
ERROR 0A000: ALGORITHM=INSTANT is not supported. Reason: ADD INDEX. Try ALGORITHM=NOCOPY
call p1();
ERROR 0A000: ALGORITHM=INSTANT is not supported. Reason: ADD INDEX. Try ALGORITHM=NOCOPY
DROP TABLE t1;
affected rows: 0
DROP PROCEDURE p1;
affected rows: 0
DROP PROCEDURE p2;
affected rows: 0
